services:
  - type: worker
    name: telegram-imf-bot
    runtime: python
    runtimeVersion: "3.11"
    region: frankfurt
    plan: starter
    branch: main
    buildCommand: pip install -r requirements.txt
    startCommand: python -m src.main
    # Graceful shutdown configuration for zero-downtime deploys
    preDeployCommand: sleep 5  # Wait for old instance to start shutdown
    healthCheckPath: /health
    healthCheckInterval: 30
    # Increase shutdown timeout to ensure clean disconnect from Telegram API
    shutdownSeconds: 30
    envVars:
      - key: TELEGRAM_BOT_TOKEN
        sync: false
      - key: ANTHROPIC_API_KEY
        sync: false
      - key: DATABASE_URL
        value: sqlite:///./bot_data.db
      - key: LOG_LEVEL
        value: INFO
      - key: MESSAGE_RETENTION_HOURS
        value: 48
      - key: ENVIRONMENT
        value: production
      - key: PORT
        value: 8080
    autoDeploy: true
